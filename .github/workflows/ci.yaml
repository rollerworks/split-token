name: Full CI process
on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

jobs:
    test:
        name: PHP ${{ matrix.php-versions }}
        runs-on: ubuntu-18.04
        strategy:
            fail-fast: false
            matrix:
                php-versions: [ '7.2', '7.3', '7.4', '8.0' ]

        steps:
            # —— Setup Github actions 🐙 —————————————————————————————————————————————
            # https://github.com/actions/checkout (official)
            -
                name: Checkout
                uses: actions/checkout@v2

            # https://github.com/shivammathur/setup-php (community)
            -
                name: Setup PHP, extensions and composer with shivammathur/setup-php
                uses: shivammathur/setup-php@v2
                with:
                    php-version: ${{ matrix.php-versions }}
                    extensions: mbstring, ctype, iconv, bcmath, filter, json
                    coverage: none
                env:
                    update: true

            # —— Composer 🧙‍️ —————————————————————————————————————————————————————————
            -
                name: Install Composer dependencies
                env:
                    SYMFONY_PHPUNIT_DISABLE_RESULT_CACHE: 1
                run: |
                    make install

            ## —— Tests ✅ ———————————————————————————————————————————————————————————
            -
                name: Run Tests
                run: |
                    make test
#    lint:
#        name: PHP-QA
#        runs-on: ubuntu-latest
#        strategy:
#            fail-fast: false
#        steps:
#            -
#                name: Checkout
#                uses: actions/checkout@v2
#
#            # https://github.com/shivammathur/setup-php (community)
#            -
#                name: Setup PHP, extensions and composer with shivammathur/setup-php
#                uses: shivammathur/setup-php@v2
#                with:
#                    php-version: '7.4'
#                    extensions: mbstring, ctype, iconv, bcmath, filter, json
#                    coverage: none
#
#            # —— Composer 🧙‍️ —————————————————————————————————————————————————————————
#            -
#                name: Install Composer dependencies
#                run: |
#                    make install
#
#            -
#                name: Run PHP-QA
#                run: |
#                    make check
